services:
  agent:
    build: .
    image: coding-agents:latest
    environment:
      - TOKEN_GITHUB=${TOKEN_GITHUB}
      - TOKEN_REVIEWER_GITHUB=${TOKEN_REVIEWER_GITHUB}
      - REVIEWER_USERNAME_GITHUB=${REVIEWER_USERNAME_GITHUB}
      - LLM_NAME=${LLM_NAME:-openai/gpt-4o-mini}
      - URL_LLM=${URL_LLM:-https://api.openai.com/v1}
      - APIKEY_LLM=${APIKEY_LLM}
    volumes:
      - repos:/tmp/clone_repo
    command: >
      sh -c 'cmd="python runner.py --repo ${REPO_NAME}";
      if [ -n "${ISSUE_NUMBER}" ]; then cmd="$cmd --issue ${ISSUE_NUMBER}"; fi;
      exec $cmd'

volumes:
  repos:
